{% extends "base.html" %}
{% load static from staticfiles %}
{% block extra_head_js %}
    <script type="text/javascript" src="{% static 'js/bootstrap-typeahead.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/modernizr.custom.js' %}"></script>
    <script>
        if (!Modernizr.xhr2) {
            window.location.href = "${request.route_url('old_browser')}";
        }
        $(function () {
            // Upload another button
            $("#upload-another").click(function () {
                $("input[name='upload_another']").val("yes");
                $('#new_archive').submit();
            });

            // Auto fill
            var sourcerer = function (field) {
                return function (query, process) {
                    $.getJSON(
                        "/api/v1/Archive/values/",
                        {field: field, q: query},
                        function (response) {
                            return process(response.values)
                        }
                    );
                };
            };
            var $submitterName = $("#id_name");
            $submitterName.typeahead({source: sourcerer("submitter_name")});

            var $siteName = $("#id_site_name");
            $siteName.typeahead({source: sourcerer("site")});

            // Remember name
            if ($submitterName.val() === "") {
                $submitterName.val(localStorage.getItem("submitter-name") || "");
            }
            $('#new_archive').submit(function () {
                localStorage.setItem("submitter-name", $submitterName.val());
            });

        });
    </script>
    <style type="text/css">
        #progress_bar {
            -webkit-transition: none;
            -moz-transition: none;
            -o-transition: none;
            transition: none;
        }
    </style>
{% endblock extra_head_js %}
{% block content %}
    <h1>Upload
        <small> a new archive for testing</small>
    </h1>
    <div class="row">
        <div class="span6">
            <!-- Upload form. Note enctype attribute! -->
            <form id="new_archive" action="{% url 'upload' %}" method="post" enctype="multipart/form-data"
                  autocomplete="false">
                <!-- to stop chromes address fill -->
                <input autocomplete="false" name="hidden" type="text" style="display:none;">
                {% csrf_token %}
                {{ form.upload_another }}
                {{ form.non_field_errors }}
                <div class="row">
                    <div class="span3">
                        {{ form.name.label_tag }}
                        {{ form.name }}
                    </div>
                    <div class="span3">
                        {{ form.site_name.label_tag }}
                        {{ form.site_name }}
                    </div>
                </div>
                <div class="row">
                    <div class="span3">
                        {{ form.archive_identifier.label_tag }}
                        {{ form.archive_identifier }}
                    </div>
                    <div class="span3">
                        {{ form.taser_ticket_number.label_tag }}
                        {{ form.taser_ticket_number }}
                    </div>
                </div>
                <div class="row">
                    <div class="span6">
                        <label for="{{ form.is_baseline.id_for_label }}">
                            {{ form.is_baseline.label}}&nbsp;{{ form.is_baseline }}
                        </label>
                    </div>
                </div>
                <div class="row">
                    <div class="span6">
                        <div id="file_select">
                            {{ form.doc_file.label_tag }}
                            {{ form.doc_file }}
                            {{ form.doc_file.help_text }}
                            {{ form.doc_file.errors }}
                        </div>
                    </div>
                </div>
                <div id="action_container">
                    <div class="form-actions">
                        <input type="submit" value="Upload Archive" class="btn btn-primary">
                        <input id="upload-another" type="button" value="Upload and Add Another" class="btn">
                        <button class="btn" type="reset">Reset</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="span6">
            <dl>
                <dt>Your Name</dt>
                <dd></dd>
                <dt>Site Name</dt>
                <dd>Must remain consistent for search functionality. ex) geneticDX and genetic DX will not be grouped
                    the same.
                </dd>
                <dt>Archive Label</dt>
                <dd>Description of the run ex) Low Loading, High LQ, CEPH Control, Good Run.</dd>
                <dt>TASER Ticket Number</dt>
                <dd>Links runs to a TASER ticket. Enter 4-digit value following FST-. This can be edited after upload if
                    ticket is created at a later time.
                </dd>
                <dt>Select File</dt>
                <dd>Choose a zipped CSA, FSA or log.</dd>
                <dt>Click Upload Archive</dt>
                <dd></dd>
            </dl>
        </div>
    </div>
{% endblock content %}