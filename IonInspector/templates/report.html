{% extends "base.html" %}
{% load staticfiles %}
{% block extra_head_js %}
        <script>
        $(function(){
            var report_url = "/archives/{{ archive.id }}/report.pdf";
            var pdf_template = '<object type="application/pdf" data="/archives/${basename}/report.pdf" height="600px" width="100%"><p>Your browser does not support PDF display</p></object>';
            console.log("merp");
            $.ajax({
                type: 'HEAD',
                url: report_url,
                success: function () {
                    $("#pdf").html(pdf_template);
                },
                error: function () {
                    $("#run_report").hide();
                    $("#no_report").show();
                }
            });
            $("#derp").error(function(){
                console.log("mega derp");
            });
            $("#ask_delete").click(function(){
                $("#delete_prompt").slideDown();
            });
            $("#no_delete").click(function(){
                $("#delete_prompt").slideUp();
            });
        });
    </script>
{% endblock extra_head_js %}
{% block content %}
    <div id="delete_prompt" class="row-fluid" style="display: none;">
        <div class="span12 alert alert-danger">
            <h2>Delete this upload forever?</h2>
            <button id="no_delete" class="btn btn-primary" >Keep</button>
            <form method="post" action="{% url 'api_dispatch_remove_archive' resource_name='Archive' api_name='v1' pk=archive.pk %}" style="margin: 0 0 0 100px; display: inline">
                <button type="submit" class="btn" >Delete Forever</button>
            </form>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div id="view_titles" class="clearfix">
                <h1>{{ archive.identifier }}</h1>
                <div class="row-fluid">
                    <h3 class="span9">{{ archive.site }}</h3>
                    <h3 class="span3" style="text-align: right">{{ archive.archive_type }}</h3>
                </div>
                <p style="float: right;"><em>{{ archive.time }}, uploaded by {{ archive.submitter_name }}</em></p>
                {% if archive.summary %}
                    <h4>{{ archive.summary }}</h4>
                {% endif %}
                {% if archive.tags.all %}
                    <div id="tags">
                        {% for tag in archive.tags %}
                            <span class="label label-inverse">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="form-actions">
                <div class="pull-left">
                    <a class="btn btn-success" href="/media/{{ archive.doc_file }}"><i class="icon-arrow-down icon-white"></i> Download Archive</a>
                    <a class="btn" href="/media/archive_files/{{ archive.pk }}/"><i class="icon-folder-open"></i> View Files</a>
                    <form method="POST" action="{% url 'api_dispatch_rerun_archive' resource_name='Archive' api_name='v1' pk=archive.pk %}" style="margin: 0; display: inline">
                        <button type="submit" class="btn"><i class="icon-repeat"></i> Re-run Tests</button>
                    </form>
                </div>
                <div class="pull-right">
                    <button id="ask_delete" class="btn btn-danger" ><i class="icon-trash icon-white"></i> Delete</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <table id="test-summary" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Test</th>
                        <th>Status</th>
                        <th>Details</th>
                        <th>Run At</th>
                        <th>Results</th>
                        <th>Readme</th>
                    </tr>
                </thead>
                <tbody>
                    {% for test in archive.diagnostics.all %}
                        <tr>
                            <td>{{ test.name }}</td>
                            <td>
                                {% if test.status == 'Unexecuted' %}
                                <span class="label">{{ test.status }}</span>
                                {% elif test.status == 'Executing' %}
                                <span class="label">{{ test.status }}</span>
                                {% elif test.status == 'Alert' %}
                                <span class="label label-important">{{ test.status }}</span>
                                {% elif test.status == 'Info' %}
                                <span class="label label-info">{{ test.status }}</span>
                                {% elif test.status == 'Warning' %}
                                <span class="label label-warning">{{ test.status }}</span>
                                {% elif test.status == 'OK' %}
                                <span class="label label-success">{{ test.status }}</span>
                                {% elif test.status == 'NA' %}
                                <span class="label">{{ test.status }}</span>
                                {% elif test.status == 'Failed' %}
                                <span class="label" style="background-color: darkred">{{ test.status }}</span>
                                {% else %}
                                <span class="label" >{{ test.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {{ test.details|safe }}
                            </td>
                            <td>
                                {{ test.start_execute }}
                            </td>
                            <td>
                                {% if test.html %}
                                <a href="/media/archive_files/{{ archive.id }}/test_results/{{ test.name }}/{{ test.html }}">Results</a>
                                {% endif %}
                            </td>
                            <td>
                                {% if test.readme %}
                                <a href="/diagnostic/{{ test.name }}">Readme</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="row-fluid" style="margin-top: 20px;">
        <div id="run_report" class="span12">
            <div id="pdf"></div>
            <a href="/archives/${basename}/report.pdf" class="btn btn-success"><i class="icon-arrow-down icon-white"></i> Download Report</a>
        </div>
        <div id="no_report" class="span12" style="display:none;">
            <small>There is no report.pdf for this archive.</small>
        </div>
    </div>
{% endblock content %}