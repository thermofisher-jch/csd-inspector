{% extends "base.html" %}
{% load staticfiles %}
{% block extra_head_js %}
        <script>
        $(function(){
            var report_url = "/archives/{{ archive.id ]}/report.pdf";
            var pdf_template = '<object type="application/pdf" data="/archives/${basename}/report.pdf" height="600px" width="100%"><p>Your browser does not support PDF display</p></object>';
            console.log("merp");
            $.ajax({
                type: 'HEAD',
                url: report_url,
                success: function () {
                    $("#pdf").html(pdf_template);
                },
                error: function () {
                    $("#run_report").hide();
                    $("#no_report").show();
                }
            });
            $("#derp").error(function(){
                console.log("mega derp");
            });
            $("#edit, #cancel").click(function(){
                $("#view_titles").toggle();
                $("#edit_titles").toggle();
                return false;
            });
            $("#ask_delete").click(function(){
                $("#delete_prompt").slideDown();
            });
            $("#no_delete").click(function(){
                $("#delete_prompt").slideUp();
            });
        });
    </script>
{% endblock extra_head_js %}
{% block content %}
    <div id="delete_prompt" class="row-fluid" style="display: none;">
        <div class="span12 alert alert-danger">
            <h2>Delete this upload forever?</h2>
            <button id="no_delete" class="btn btn-primary" >Keep</button>
            <form  method="POST" action="${request.route_url('super_delete', archive_id=archive.id)}" style="margin: 0 0 0 100px; display: inline">
                <input type="hidden" name="csrf_token" value="${request.session.get_csrf_token()}"/>
                <button type="submit" class="btn" >Delete Forever</button>
            </form>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div id="view_titles" class="clearfix">
                <h1>{{ archive.label }}</h1>
                <div class="row-fluid">
                    <h3 class="span9">{{ archive.site }}</h3>
                    <h3 class="span3" style="text-align: right">{{ archive.archive_type }}</h3>
                </div>
                <p style="float: right;"><em>{{ archive.time }}, uploaded by {{ archive.submitter_name }}</em></p>
                {% if archive.summary %}
                    <h4>{{ archive.summary }}</h4>
                {% endif %}
                {% if archive.tags.all %}
                    <div id="tags">
                        {% for tag in archive.tags %}
                            <span class="label label-inverse">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <form id="edit_titles" action="{{ equest.session.session_key }}" method="post" style="display:none;">
                <input type="hidden" name="csrf_token" value="{{ request.session.session_key }}"/>
                <input class="form-h1 span12" name="label" placeholder="Label" value="{{ archive.label }}" />
                <div class="row-fluid">
                    <div class="span7" style="text-align:left;">
                        <input class="form-h3 span7" name="site" placeholder="Site" value="{{archive.site }}" />
                    </div>
                    <div class="span5" style="text-align:right; margin-top:12px;">
                        <select name="archive_type" id="archiveType">
                            {% for type in archive_types %}
                                <option value="{{ type }}" }>
                                    {{ type }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span6">
                        <input name="summary" class="form-h4" placeholder="Summary" value="${archive.summary}" style="width: 300px;" maxlength="30"></input><br/>
                        <input name="tags" placeholder="Tags" value="${tag_string}"></input>
                    </div>
                    <div class="span6" style="text-align: right;">
                        <p><em>${archive.time.strftime("%c")}, uploaded by ${archive.submitter_name}</em></p>
                        <input type="button" id="cancel" class="btn" value="Cancel" />
                        <input type="submit" class="btn btn-primary" value="Save Changes" />
                    </div>
                </div>
            </form>
            <div class="form-actions">
                <div class="pull-left">
                    <a class="btn btn-success" href="/archives/${basename}/${download_file}"><i class="icon-arrow-down icon-white"></i> Download Archive</a>
                    <a class="btn" href="/archives/${basename}/"><i class="icon-folder-open"></i> View Files</a>
                    <a id="edit" class="btn" href="#"><i class="icon-pencil"></i> Edit</a>
                    <form method="POST" action="${request.route_url('rerun', archive_id=archive.id)}" style="margin: 0; display: inline">
                        <input type="hidden" name="csrf_token" value="${request.session.get_csrf_token()}"/>
                        <button type="submit" class="btn"><i class="icon-repeat"></i> Re-run Tests</button>
                    </form>
                </div>
                <div class="pull-right">
                    <button id="ask_delete" class="btn btn-danger" ><i class="icon-trash icon-white"></i> Delete</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <table id="test-summary" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Test</th><th>Status</th><th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for test in archive.diagnostics.all %}
                        <tr>
                            <td>{{ test.name }}</td>
                            <td>
                                <span class="label">{{ test.status }}</span>
                            </td>
                            <td>
                                <div class="links">
                                    <div>
                                        <a href="{% static 'test.html' %}">Results</a>
                                    </div>
                                    <div>
                                        <a href="{% static 'test_readme/test.name' %}">Readme</a>
                                    </div>
                                </div>
                                {{ test.details }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="row-fluid" style="margin-top: 20px;">
        <div id="run_report" class="span12">
            <div id="pdf"></div>
            <a href="/archives/${basename}/report.pdf" class="btn btn-success"><i class="icon-arrow-down icon-white"></i> Download Report</a>
        </div>
        <div id="no_report" class="span12" style="display:none;">
            <small>There is no report.pdf for this archive.</small>
        </div>
    </div>
{% endblock content %}